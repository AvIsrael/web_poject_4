!function(){"use strict";class e{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=t}_showInputError(e){const t=this._formElement.querySelector(".".concat(e.id,"-error"));e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._errorClass)}_hideInputError(e){const t=this._formElement.querySelector(".".concat(e.id,"-error"));e.classList.remove(this._inputErrorClass),t.classList.remove(this._errorClass),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput()?(this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.disabled=!0):(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.disabled=!1)}_setEventListeners(){this._inputList=this._formElement.querySelectorAll(this._inputSelector),this._buttonElement=this._formElement.querySelector(this._submitButtonSelector),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}_hideValidationMessage(){this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._inputList.forEach((e=>{this._hideInputError(e)}))}resetWholeForm(){this._hideValidationMessage(),this._toggleButtonState(),this._formElement.reset()}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}}function t(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class s{constructor(e,s,n,r,i,o,a,l){let{handleCardClick:h,handleLikeButton:c,handleDeleteCard:u}=l;t(this,"removeCardFromDOM",(()=>{this._element.remove(),this._element=null})),t(this,"handleLikeCard",(e=>{this._likes=e,this._renderLikes()})),this._name=e,this._link=s,this._cardSelector=a,this._handleCardClick=h,this._handleLikeButton=c,this._handleDeleteCard=u,this._id=n,this._userId=i,this._ownerId=r,this._likes=o}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".elements__item").cloneNode(!0)}_setEventListeners(){this._deleteButton.addEventListener("click",(()=>this._handleDeleteCard(this._id))),this._likeButton.addEventListener("click",(()=>this._handleLikeButton(this._id))),this._cardImage.addEventListener("click",(()=>this._handleCardClick({name:this._name,src:this._link})))}isLiked(){return this._likes.some((e=>e._id===this._userId))}_renderLikes(){this._likesCount.textContent=this._likes.length,this.isLiked()?this._likeButton.classList.add("elements__button-heart_active"):this._likeButton.classList.remove("elements__button-heart_active")}generateCard(){return this._element=this._getTemplate(),this._cardImage=this._element.querySelector(".elements__grid-image"),this._cardName=this._element.querySelector(".elements__description"),this._likesCount=this._element.querySelector(".elements__amount-likes"),this._likeButton=this._element.querySelector(".elements__button-heart"),this._deleteButton=this._element.querySelector(".elements__button-delete"),this._setEventListeners(),this._cardImage.src=this._link,this._cardImage.alt="Photo of ".concat(this._name),this._cardName.textContent=this._name,this._renderLikes(),this._ownerId!==this._userId&&(this._deleteButton.style.display="none"),this._element}}const n={formSelector:".popup__form",inputSelector:".popup__item",submitButtonSelector:".popup__button-sbmt",inactiveButtonClass:"popup__button-sbmt_disabled",inputErrorClass:"popup__item_type_error",errorClass:"popup__error_visible"};class r{constructor(e){var t,s;s=e=>{"Escape"===e.key&&this.close()},(t="_handleEscClose")in this?Object.defineProperty(this,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[t]=s,this._popupElement=document.querySelector(e)}open(){this._popupElement.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popupElement.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._popupElement.addEventListener("mousedown",(e=>{(e.target.classList.contains("popup_opened")||e.target.classList.contains("popup__button"))&&this.close()}))}}class i extends r{constructor(e,t,s){super(e),this._handleFormSubmit=t,this._popupForm=this._popupElement.querySelector(".popup__form"),this._buttonSubmit=this._popupElement.querySelector(".popup__button-sbmt"),this._buttonTextValue=s,this._inputs=Array.from(this._popupForm.querySelectorAll(".popup__item"))}_getInputValues(){const e={};return this._inputs.forEach((t=>{e[t.name]=t.value})),e}showMessageLoading(){this._buttonSubmit.value="Saving..."}hideMessageLoading(){this._buttonSubmit.value=this._buttonTextValue}close(){super.close(),this._popupForm.reset()}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",(()=>this._handleFormSubmit(this._getInputValues())))}}const o=document.querySelector(".profile__button-unusual"),a=document.querySelector(".profile__button"),l=document.getElementById("formElementEdit"),h=document.getElementById("formElementAdd"),c=document.getElementById("formElementImage"),u=document.getElementById("name"),d=document.getElementById("about"),_=document.querySelector(".profile__image-overlay"),m=new class{constructor(e){let{baseUrl:t,headers:s}=e;var n,r;r=(e,t)=>fetch(e,t).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status)))),(n="_customFetch")in this?Object.defineProperty(this,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[n]=r,this._baseUrl=t,this._headers=s}getUserInfo(){return this._customFetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers})}getInitialCards(){return this._customFetch("".concat(this._baseUrl,"/cards"),{headers:this._headers})}createCard(e){return this._customFetch("".concat(this._baseUrl,"/cards"),{headers:this._headers,method:"POST",body:JSON.stringify(e)})}deleteCard(e){return this._customFetch("".concat(this._baseUrl,"/cards/").concat(e),{headers:this._headers,method:"DELETE"})}editProfile(e){let{name:t,about:s}=e;return this._customFetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers,method:"PATCH",body:JSON.stringify({name:t,about:s})})}editAvatar(e){let{avatar:t}=e;return this._customFetch("".concat(this._baseUrl,"/users/me/avatar"),{headers:this._headers,method:"PATCH",body:JSON.stringify({avatar:t})})}likeCard(e){return this._customFetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{headers:this._headers,method:"PUT"})}unlikeCard(e){return this._customFetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{headers:this._headers,method:"DELETE"})}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"cc8ab050-a9c0-4b6f-94ee-d21a7e05974a","Content-Type":"application/json"}}),p=new class{constructor(e){let{userNameSelector:t,userJobSelector:s,avatarSelector:n}=e;this._userNameElement=document.querySelector(t),this._userJobElement=document.querySelector(s),this._avatarElement=document.querySelector(n)}getUserInfo(){return{name:this._userNameElement.textContent,about:this._userJobElement.textContent}}setUserInfo(e){let{name:t,about:s}=e;this._userNameElement.textContent=t,this._userJobElement.textContent=s}setAvatar(e){let{avatar:t}=e;this._avatarElement.style.backgroundImage="url(".concat(t||this._avatar,")")}}({userNameSelector:".profile__hero",userJobSelector:".profile__role",avatarSelector:".profile__avatar"}),E=new i("#popup-edit",(function(e){E.showMessageLoading(),m.editProfile(e).then((e=>{p.setUserInfo(e),E.close()})).catch((e=>{console.log("Error: ".concat(e))})).finally((()=>{E.hideMessageLoading()}))}),"Save"),b=new i("#popup-add",(function(e){b.showMessageLoading();const t={name:e.title,link:e["image-link"]};m.createCard(t).then((e=>{y.addItem(e.name,e.link,e._id,e.owner._id,e.likes),b.close()})).catch((e=>{console.log("Error: ".concat(e))})).finally((()=>{b.hideMessageLoading()}))}),"Create"),v=new class extends r{constructor(e){super(e),this._imageZoom=this._popupElement.querySelector(".popup__viewer-image"),this._imageZoomTitle=this._popupElement.querySelector(".popup__viewer-text")}open(e,t){super.open(),this._imageZoom.src=t,this._imageZoom.alt="Photo of ".concat(e),this._imageZoomTitle.textContent=e}}("#popup-viewer"),g=new class extends r{constructor(e){super(e),this._inputSubmit=this._popupElement.querySelector(".popup__button-sbmt")}setAction(e){this._handleSubmit=e}setEventListeners(){super.setEventListeners(),this._popupElement.addEventListener("submit",(e=>{e.preventDefault(),this._handleSubmit()}))}showMessageLoading(){this._inputSubmit.value="Deleting..."}hideMessageLoading(){this._inputSubmit.value="Yes"}}("#popup-delete"),L=new i("#popup-profile-image",(function(e){L.showMessageLoading(),m.editAvatar(e).then((e=>{p.setAvatar(e),L.close()})).catch((e=>{console.log("Error: ".concat(e))})).finally((()=>{L.hideMessageLoading()}))}),"Save");E.setEventListeners(),b.setEventListeners(),v.setEventListeners(),g.setEventListeners(),L.setEventListeners(),o.addEventListener("click",(function(){E.open();const{name:e,about:t}=p.getUserInfo();f.resetWholeForm(),u.value=e,d.value=t}));const S=new e(n,h);S.enableValidation();const f=new e(n,l);f.enableValidation();const C=new e(n,c);C.enableValidation(),a.addEventListener("click",(function(){b.open(),S.resetWholeForm()}));const y=new class{constructor(e,t){let{renderer:s}=e;this._renderer=s,this._container=document.querySelector(t)}addItem(e,t,s,n,r){const i=this._renderer(e,t,s,n,r);this._container.prepend(i)}renderItems(e){e.forEach((e=>{this.addItem(e.name,e.link,e._id,e.owner._id,e.likes)}))}}({renderer:(e,t,n,r,i)=>{const o=new s(e,t,n,r,k,i,"#card",{handleCardClick:()=>{v.open(e,t)},handleDeleteCard:e=>{g.open(),g.setAction((()=>{g.showMessageLoading(),m.deleteCard(e).then((()=>{o.removeCardFromDOM(),g.close()})).catch((e=>{console.log("Error: ".concat(e))})).finally((()=>{g.hideMessageLoading()}))}))},handleLikeButton:e=>{o.isLiked()?m.unlikeCard(e).then((e=>{o.handleLikeCard(e.likes)})).catch((e=>{console.log("Error: ".concat(e))})):m.likeCard(e).then((e=>{o.handleLikeCard(e.likes)})).catch((e=>{console.log("Error: ".concat(e))}))}});return o.generateCard()}},".elements__items");let k;Promise.all([m.getUserInfo(),m.getInitialCards()]).then((e=>{let[t,s]=e;k=t._id,p.setUserInfo({name:t.name,about:t.about}),p.setAvatar({avatar:t.avatar}),y.renderItems(s.reverse())})).catch((e=>{console.log("Error: ".concat(e))})),_.addEventListener("click",(function(){L.open(),C.resetWholeForm()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TUFBSyxLQUNGcUUsRUFBS0ssb0JBQ0xwQixFQUFZM0YsV0FFZjZFLE9BQU9DLElBQ0pDLFFBQVFDLElBQVIsaUJBQXNCRixPQUV6QkcsU0FBUSxLQUNMVSxFQUFZckUsNEJBR3pCMUQsaUJBQW1CcEMsSUFDS2tMLEVBQUt2SCxVQUV4QjZDLEVBQ0s4QixXQUFXdEksR0FDWDZHLE1BQU1DLElBQ0hvRSxFQUFLTSxlQUFlMUUsRUFBSTdFLFVBRTNCb0gsT0FBT0MsSUFDSkMsUUFBUUMsSUFBUixpQkFBc0JGLE9BRzlCOUMsRUFDSzZCLFNBQVNySSxHQUNUNkcsTUFBTUMsSUFDSG9FLEVBQUtNLGVBQWUxRSxFQUFJN0UsVUFFM0JvSCxPQUFPQyxJQUNKQyxRQUFRQyxJQUFSLGlCQUFzQkYsVUFLMUMsT0FBTzRCLEVBQUtuSCxpQkFFakIsb0JBR0gsSUFBSS9CLEVBQ0ppRixRQUFRd0UsSUFBSSxDQUFDakYsRUFBSWMsY0FBZWQsRUFBSWdCLG9CQUMvQlgsTUFBSyxJQUEwQixJQUF4QjZELEVBQVVnQixHQUFjLEVBQzVCMUosRUFBUzBJLEVBQVMxSCxJQUNsQndGLEVBQVNPLFlBQVksQ0FDakJsSCxLQUFNNkksRUFBUzdJLEtBQU1xRyxNQUFPd0MsRUFBU3hDLFFBRXpDTSxFQUFTUSxVQUFVLENBQUNaLE9BQVFzQyxFQUFTdEMsU0FDckN5QixFQUFTdUIsWUFBWU0sRUFBU0MsY0FFakN0QyxPQUFPQyxJQUNKQyxRQUFRQyxJQUFSLGlCQUFzQkYsT0FTOUIvQyxFQUFvQnBGLGlCQUFpQixTQU5yQyxXQUNJc0osRUFBa0IvRixPQUNsQm1HLEVBQTBCdEosb0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdHMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvc2NyaXB0cy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9zY3JpcHRzL3V0aWxzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdHMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdHMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3Jtcy5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvc2NyaXB0cy9jb21wb25lbnRzL0FwaS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdHMvY29tcG9uZW50cy9Vc2VySW5mby5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdHMvY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdHMvY29tcG9uZW50cy9Qb3B1cFdpdGhEZWxldGluZy5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdHMvY29tcG9uZW50cy9TZWN0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGNsYXNzIEZvcm1WYWxpZGF0b3Ige1xyXG4gICAgY29uc3RydWN0b3Ioc2V0dGluZ3NWYWxpZGF0b3IsIGZvcm1FbGVtZW50KSB7XHJcbiAgICAgICAgdGhpcy5faW5wdXRTZWxlY3RvciA9IHNldHRpbmdzVmFsaWRhdG9yLmlucHV0U2VsZWN0b3I7XHJcbiAgICAgICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IgPSBzZXR0aW5nc1ZhbGlkYXRvci5zdWJtaXRCdXR0b25TZWxlY3RvcjtcclxuICAgICAgICB0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzID0gc2V0dGluZ3NWYWxpZGF0b3IuaW5hY3RpdmVCdXR0b25DbGFzcztcclxuICAgICAgICB0aGlzLl9pbnB1dEVycm9yQ2xhc3MgPSBzZXR0aW5nc1ZhbGlkYXRvci5pbnB1dEVycm9yQ2xhc3M7XHJcbiAgICAgICAgdGhpcy5fZXJyb3JDbGFzcyA9IHNldHRpbmdzVmFsaWRhdG9yLmVycm9yQ2xhc3M7XHJcbiAgICAgICAgdGhpcy5fZm9ybUVsZW1lbnQgPSBmb3JtRWxlbWVudDtcclxuICAgIH07XHJcblxyXG4gICAgX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xyXG4gICAgICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcclxuICAgICAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xyXG4gICAgICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZTtcclxuICAgICAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9lcnJvckNsYXNzKTtcclxuICAgIH07XHJcblxyXG4gICAgX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xyXG4gICAgICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcclxuICAgICAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xyXG4gICAgICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2Vycm9yQ2xhc3MpO1xyXG4gICAgICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XHJcbiAgICB9O1xyXG5cclxuICAgIF9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbGVtZW50KSB7XHJcbiAgICAgICAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcclxuICAgICAgICAgICAgdGhpcy5fc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgX2hhc0ludmFsaWRJbnB1dCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faW5wdXRMaXN0LnNvbWUoKGlucHV0RWxlbWVudCkgPT4gIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCk7XHJcbiAgICB9O1xyXG5cclxuICAgIF90b2dnbGVCdXR0b25TdGF0ZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KCkpIHtcclxuICAgICAgICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgICAgICAgICB0aGlzLl9idXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9idXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICAgICAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgICB0aGlzLl9pbnB1dExpc3QgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpO1xyXG4gICAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcclxuICAgICAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgX2hpZGVWYWxpZGF0aW9uTWVzc2FnZSgpIHtcclxuICAgICAgICB0aGlzLl9pbnB1dExpc3QgPSBBcnJheS5mcm9tKFxyXG4gICAgICAgICAgICB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpXHJcbiAgICAgICAgKTtcclxuICAgICAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIHJlc2V0V2hvbGVGb3JtKCkge1xyXG4gICAgICAgIHRoaXMuX2hpZGVWYWxpZGF0aW9uTWVzc2FnZSgpO1xyXG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XHJcbiAgICAgICAgdGhpcy5fZm9ybUVsZW1lbnQucmVzZXQoKTtcclxuICAgIH07XHJcblxyXG4gICAgZW5hYmxlVmFsaWRhdGlvbigpIHtcclxuICAgICAgICB0aGlzLl9mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcclxuICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIH07XHJcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkIHtcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIG5hbWUsIGxpbmssIGlkLCBvd25lcklkLCB1c2VySWQsIGxpa2VzLCBjYXJkU2VsZWN0b3IsXHJcbiAgICAgICAge2hhbmRsZUNhcmRDbGljaywgaGFuZGxlTGlrZUJ1dHRvbiwgaGFuZGxlRGVsZXRlQ2FyZH0sXHJcblxyXG5cclxuICAgICkge1xyXG4gICAgICAgIHRoaXMuX25hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMuX2xpbmsgPSBsaW5rO1xyXG4gICAgICAgIHRoaXMuX2NhcmRTZWxlY3RvciA9IGNhcmRTZWxlY3RvcjtcclxuICAgICAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2sgPSBoYW5kbGVDYXJkQ2xpY2s7XHJcbiAgICAgICAgdGhpcy5faGFuZGxlTGlrZUJ1dHRvbiA9IGhhbmRsZUxpa2VCdXR0b247XHJcbiAgICAgICAgdGhpcy5faGFuZGxlRGVsZXRlQ2FyZCA9IGhhbmRsZURlbGV0ZUNhcmQ7XHJcbiAgICAgICAgdGhpcy5faWQgPSBpZDtcclxuICAgICAgICB0aGlzLl91c2VySWQgPSB1c2VySWQ7XHJcbiAgICAgICAgdGhpcy5fb3duZXJJZCA9IG93bmVySWQ7XHJcbiAgICAgICAgdGhpcy5fbGlrZXMgPSBsaWtlcztcclxuICAgIH1cclxuXHJcbiAgICBfZ2V0VGVtcGxhdGUoKSB7XHJcbiAgICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBkb2N1bWVudFxyXG4gICAgICAgICAgICAucXVlcnlTZWxlY3Rvcih0aGlzLl9jYXJkU2VsZWN0b3IpXHJcbiAgICAgICAgICAgIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudHNfX2l0ZW1cIilcclxuICAgICAgICAgICAgLmNsb25lTm9kZSh0cnVlKTtcclxuICAgICAgICByZXR1cm4gY2FyZEVsZW1lbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICAgIHRoaXMuX2RlbGV0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT5cclxuICAgICAgICAgICAgdGhpcy5faGFuZGxlRGVsZXRlQ2FyZCh0aGlzLl9pZClcclxuICAgICAgICApO1xyXG4gICAgICAgIHRoaXMuX2xpa2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XHJcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZUxpa2VCdXR0b24odGhpcy5faWQpXHJcbiAgICAgICAgKTtcclxuICAgICAgICB0aGlzLl9jYXJkSW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XHJcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljayh7IG5hbWU6IHRoaXMuX25hbWUsIHNyYzogdGhpcy5fbGluayB9KVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVtb3ZlQ2FyZEZyb21ET00gPSAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudC5yZW1vdmUoKTtcclxuICAgICAgICB0aGlzLl9lbGVtZW50ID0gbnVsbDtcclxuICAgIH07XHJcblxyXG5cclxuICAgIGlzTGlrZWQoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9saWtlcy5zb21lKChsaWtlZENhcmQpID0+IGxpa2VkQ2FyZC5faWQgPT09IHRoaXMuX3VzZXJJZCk7XHJcbiAgICB9XHJcbiAgICBoYW5kbGVMaWtlQ2FyZCA9IChhZGRMaWtlKSA9PiB7XHJcbiAgICAgICAgdGhpcy5fbGlrZXMgPSBhZGRMaWtlO1xyXG4gICAgICAgIHRoaXMuX3JlbmRlckxpa2VzKCk7XHJcbiAgICB9O1xyXG4gICAgX3JlbmRlckxpa2VzKCkge1xyXG4gICAgICAgICAgICB0aGlzLl9saWtlc0NvdW50LnRleHRDb250ZW50ID0gdGhpcy5fbGlrZXMubGVuZ3RoO1xyXG4gICAgICAgIGlmICh0aGlzLmlzTGlrZWQoKSkge1xyXG4gICAgICAgICAgICB0aGlzLl9saWtlQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJlbGVtZW50c19fYnV0dG9uLWhlYXJ0X2FjdGl2ZVwiKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9saWtlQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJlbGVtZW50c19fYnV0dG9uLWhlYXJ0X2FjdGl2ZVwiKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGdlbmVyYXRlQ2FyZCgpIHtcclxuICAgICAgICB0aGlzLl9lbGVtZW50ID0gdGhpcy5fZ2V0VGVtcGxhdGUoKTtcclxuICAgICAgICB0aGlzLl9jYXJkSW1hZ2UgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudHNfX2dyaWQtaW1hZ2VcIik7XHJcbiAgICAgICAgdGhpcy5fY2FyZE5hbWUgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudHNfX2Rlc2NyaXB0aW9uXCIpO1xyXG4gICAgICAgIHRoaXMuX2xpa2VzQ291bnQgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudHNfX2Ftb3VudC1saWtlc1wiKTtcclxuICAgICAgICB0aGlzLl9saWtlQnV0dG9uID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRzX19idXR0b24taGVhcnRcIik7XHJcbiAgICAgICAgdGhpcy5fZGVsZXRlQnV0dG9uID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRzX19idXR0b24tZGVsZXRlXCIpO1xyXG4gICAgICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICAgICAgdGhpcy5fY2FyZEltYWdlLnNyYyA9IHRoaXMuX2xpbms7XHJcbiAgICAgICAgdGhpcy5fY2FyZEltYWdlLmFsdCA9IGBQaG90byBvZiAke3RoaXMuX25hbWV9YDtcclxuICAgICAgICB0aGlzLl9jYXJkTmFtZS50ZXh0Q29udGVudCA9IHRoaXMuX25hbWU7XHJcbiAgICAgICAgdGhpcy5fcmVuZGVyTGlrZXMoKTtcclxuICAgICAgICBpZiAodGhpcy5fb3duZXJJZCAhPT0gdGhpcy5fdXNlcklkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2RlbGV0ZUJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLl9lbGVtZW50O1xyXG4gICAgfVxyXG5cclxufSIsImV4cG9ydCBjb25zdCBzZXR0aW5nc1ZhbGlkYXRvciA9IHtcclxuICAgIGZvcm1TZWxlY3RvcjogXCIucG9wdXBfX2Zvcm1cIixcclxuICAgIGlucHV0U2VsZWN0b3I6IFwiLnBvcHVwX19pdGVtXCIsXHJcbiAgICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIucG9wdXBfX2J1dHRvbi1zYm10XCIsXHJcbiAgICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcInBvcHVwX19idXR0b24tc2JtdF9kaXNhYmxlZFwiLFxyXG4gICAgaW5wdXRFcnJvckNsYXNzOiBcInBvcHVwX19pdGVtX3R5cGVfZXJyb3JcIixcclxuICAgIGVycm9yQ2xhc3M6IFwicG9wdXBfX2Vycm9yX3Zpc2libGVcIixcclxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwIHtcclxuICAgIGNvbnN0cnVjdG9yKG1vZGFsV2luZG93KSB7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihtb2RhbFdpbmRvdyk7XHJcbiAgICB9XHJcblxyXG4gICAgb3BlbigpIHtcclxuICAgICAgICB0aGlzLl9wb3B1cEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInBvcHVwX29wZW5lZFwiKTtcclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XHJcbiAgICB9XHJcblxyXG4gICAgY2xvc2UoKSB7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJwb3B1cF9vcGVuZWRcIik7XHJcbiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIF9oYW5kbGVFc2NDbG9zZSA9IChldnQpID0+IHtcclxuICAgICAgICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xyXG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgICB0aGlzLl9wb3B1cEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoZXZ0KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgICAgIGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwicG9wdXBfb3BlbmVkXCIpIHx8XHJcbiAgICAgICAgICAgICAgICBldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInBvcHVwX19idXR0b25cIilcclxuICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoRm9ybSBleHRlbmRzIFBvcHVwIHtcclxuICAgIGNvbnN0cnVjdG9yKG1vZGFsV2luZG93LCBoYW5kbGVGb3JtU3VibWl0LCBidXR0b25UZXh0VmFsdWUpIHtcclxuICAgICAgICBzdXBlcihtb2RhbFdpbmRvdyk7XHJcbiAgICAgICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCA9IGhhbmRsZUZvcm1TdWJtaXQ7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBGb3JtID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm1cIik7XHJcbiAgICAgICAgdGhpcy5fYnV0dG9uU3VibWl0ID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2J1dHRvbi1zYm10XCIpO1xyXG4gICAgICAgIHRoaXMuX2J1dHRvblRleHRWYWx1ZSA9IGJ1dHRvblRleHRWYWx1ZTtcclxuICAgICAgICB0aGlzLl9pbnB1dHMgPSBBcnJheS5mcm9tKFxyXG4gICAgICAgICAgICB0aGlzLl9wb3B1cEZvcm0ucXVlcnlTZWxlY3RvckFsbChcIi5wb3B1cF9faXRlbVwiKVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgX2dldElucHV0VmFsdWVzKCkge1xyXG4gICAgICAgIGNvbnN0IGlucHV0VmFsdWVzID0ge307XHJcbiAgICAgICAgdGhpcy5faW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XHJcbiAgICAgICAgICAgIGlucHV0VmFsdWVzW2lucHV0Lm5hbWVdID0gaW5wdXQudmFsdWU7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGlucHV0VmFsdWVzO1xyXG4gICAgfVxyXG5cclxuICAgIHNob3dNZXNzYWdlTG9hZGluZygpIHtcclxuICAgICAgICB0aGlzLl9idXR0b25TdWJtaXQudmFsdWUgPSBcIlNhdmluZy4uLlwiO1xyXG4gICAgfVxyXG4gICAgaGlkZU1lc3NhZ2VMb2FkaW5nKCkge1xyXG4gICAgICAgIHRoaXMuX2J1dHRvblN1Ym1pdC52YWx1ZSA9IHRoaXMuX2J1dHRvblRleHRWYWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBjbG9zZSgpIHtcclxuICAgICAgICBzdXBlci5jbG9zZSgpO1xyXG4gICAgICAgIHRoaXMuX3BvcHVwRm9ybS5yZXNldCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKCkgPT5cclxuICAgICAgICAgICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCh0aGlzLl9nZXRJbnB1dFZhbHVlcygpKVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vc2NyaXB0cy9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcclxuaW1wb3J0IENhcmQgZnJvbSBcIi4uL3NjcmlwdHMvY29tcG9uZW50cy9DYXJkLmpzXCJcclxuaW1wb3J0IFNlY3Rpb24gZnJvbSBcIi4uL3NjcmlwdHMvY29tcG9uZW50cy9TZWN0aW9uXCI7XHJcbmltcG9ydCBcIi4vaW5kZXguY3NzXCJcclxuaW1wb3J0IHtcclxuICAgIHNldHRpbmdzVmFsaWRhdG9yXHJcbn0gZnJvbSBcIi4uL3NjcmlwdHMvdXRpbHMvY29uc3RhbnRzXCJcclxuaW1wb3J0IFBvcHVwV2l0aEZvcm0gZnJvbSBcIi4uL3NjcmlwdHMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3Jtc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoSW1hZ2UgZnJvbSBcIi4uL3NjcmlwdHMvY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xyXG5pbXBvcnQgVXNlckluZm8gZnJvbSBcIi4uL3NjcmlwdHMvY29tcG9uZW50cy9Vc2VySW5mby5qc1wiO1xyXG5pbXBvcnQgQXBpIGZyb20gXCIuLi9zY3JpcHRzL2NvbXBvbmVudHMvQXBpLmpzXCI7XHJcbmltcG9ydCB7UG9wdXBXaXRoRGVsZXRpbmd9IGZyb20gXCIuLi9zY3JpcHRzL2NvbXBvbmVudHMvUG9wdXBXaXRoRGVsZXRpbmdcIjtcclxuXHJcbmNvbnN0IGJ1dHRvbkVkaXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2J1dHRvbi11bnVzdWFsXCIpO1xyXG5jb25zdCBidXR0b25BZGQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2J1dHRvblwiKTtcclxuY29uc3QgZm9ybUVsZW1lbnRFZGl0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJmb3JtRWxlbWVudEVkaXRcIik7XHJcbmNvbnN0IGZvcm1FbGVtZW50QWRkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJmb3JtRWxlbWVudEFkZFwiKTtcclxuY29uc3QgZm9ybUVsZW1lbnRJbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZm9ybUVsZW1lbnRJbWFnZVwiKTtcclxuY29uc3QgbmFtZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJuYW1lXCIpO1xyXG5jb25zdCBqb2JJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYWJvdXRcIik7XHJcbmNvbnN0IHByb2ZpbGVJbWFnZU92ZXJsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2ltYWdlLW92ZXJsYXlcIilcclxuXHJcbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xyXG4gICAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2dyb3VwLTEyXCIsIGhlYWRlcnM6IHtcclxuICAgICAgICBhdXRob3JpemF0aW9uOiBcImNjOGFiMDUwLWE5YzAtNGI2Zi05NGVlLWQyMWE3ZTA1OTc0YVwiLCBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgIH0sXHJcbn0pO1xyXG5cclxuY29uc3QgdXNlckluZm8gPSBuZXcgVXNlckluZm8oe1xyXG4gICAgdXNlck5hbWVTZWxlY3RvcjogXCIucHJvZmlsZV9faGVyb1wiLCB1c2VySm9iU2VsZWN0b3I6IFwiLnByb2ZpbGVfX3JvbGVcIiwgYXZhdGFyU2VsZWN0b3I6IFwiLnByb2ZpbGVfX2F2YXRhclwiLFxyXG59KTtcclxuXHJcblxyXG5jb25zdCBlZGl0UG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShcIiNwb3B1cC1lZGl0XCIsIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0LCBcIlNhdmVcIik7XHJcblxyXG5jb25zdCBhZGRDYXJkUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShcIiNwb3B1cC1hZGRcIiwgaGFuZGxlQWRkQ2FyZEZvcm1TdWJtaXQsIFwiQ3JlYXRlXCIpO1xyXG5cclxuY29uc3QgaW1hZ2VQb3B1cCA9IG5ldyBQb3B1cFdpdGhJbWFnZShcIiNwb3B1cC12aWV3ZXJcIik7XHJcblxyXG5jb25zdCBkZWxldGVQb3B1cCA9IG5ldyBQb3B1cFdpdGhEZWxldGluZyhcIiNwb3B1cC1kZWxldGVcIik7XHJcblxyXG5jb25zdCBwcm9maWxlSW1hZ2VQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiI3BvcHVwLXByb2ZpbGUtaW1hZ2VcIiwgaGFuZGxlSW1hZ2VGb3JtU3VibWl0LCBcIlNhdmVcIik7XHJcblxyXG5lZGl0UG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbmFkZENhcmRQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuaW1hZ2VQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuZGVsZXRlUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbnByb2ZpbGVJbWFnZVBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdChkYXRhVXNlcnMpIHtcclxuICAgIGVkaXRQb3B1cC5zaG93TWVzc2FnZUxvYWRpbmcoKTtcclxuICAgIGFwaVxyXG4gICAgICAgIC5lZGl0UHJvZmlsZShkYXRhVXNlcnMpXHJcbiAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgICAgICB1c2VySW5mby5zZXRVc2VySW5mbyhyZXMpO1xyXG4gICAgICAgICAgICBlZGl0UG9wdXAuY2xvc2UoKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBFcnJvcjogJHtlcnJ9YCk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgICAgICAgIGVkaXRQb3B1cC5oaWRlTWVzc2FnZUxvYWRpbmcoKTtcclxuICAgICAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlRWRpdEJ1dHRvbigpIHtcclxuICAgIGVkaXRQb3B1cC5vcGVuKCk7XHJcbiAgICBjb25zdCB7bmFtZSwgYWJvdXR9ID0gdXNlckluZm8uZ2V0VXNlckluZm8oKTtcclxuICAgIGZvcm1FbGVtZW50RWRpdFZhbGlkYXRvci5yZXNldFdob2xlRm9ybSgpO1xyXG4gICAgbmFtZUlucHV0LnZhbHVlID0gbmFtZTtcclxuICAgIGpvYklucHV0LnZhbHVlID0gYWJvdXQ7XHJcblxyXG59XHJcblxyXG5idXR0b25FZGl0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVFZGl0QnV0dG9uKTtcclxuZXhwb3J0IGNvbnN0IGZvcm1FbGVtZW50QWRkVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3Ioc2V0dGluZ3NWYWxpZGF0b3IsIGZvcm1FbGVtZW50QWRkKTtcclxuZm9ybUVsZW1lbnRBZGRWYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xyXG5cclxuZXhwb3J0IGNvbnN0IGZvcm1FbGVtZW50RWRpdFZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKHNldHRpbmdzVmFsaWRhdG9yLCBmb3JtRWxlbWVudEVkaXQpO1xyXG5mb3JtRWxlbWVudEVkaXRWYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xyXG5cclxuZXhwb3J0IGNvbnN0IGZvcm1FbGVtZW50SW1hZ2VWYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihzZXR0aW5nc1ZhbGlkYXRvciwgZm9ybUVsZW1lbnRJbWFnZSk7XHJcbmZvcm1FbGVtZW50SW1hZ2VWYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xyXG5cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUFkZENhcmRGb3JtU3VibWl0KGRhdGFJbWFnZXMpIHtcclxuICAgIGFkZENhcmRQb3B1cC5zaG93TWVzc2FnZUxvYWRpbmcoKTtcclxuICAgIGNvbnN0IGRhdGEgPSB7XHJcbiAgICAgICAgbmFtZTogZGF0YUltYWdlcy50aXRsZSwgbGluazogZGF0YUltYWdlc1snaW1hZ2UtbGluayddLFxyXG4gICAgfTtcclxuICAgIGFwaVxyXG4gICAgICAgIC5jcmVhdGVDYXJkKGRhdGEpXHJcbiAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgICAgICBjYXJkTGlzdC5hZGRJdGVtKHJlcy5uYW1lLCByZXMubGluaywgcmVzLl9pZCwgcmVzLm93bmVyLl9pZCwgcmVzLmxpa2VzKTtcclxuICAgICAgICAgICAgYWRkQ2FyZFBvcHVwLmNsb3NlKCk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgRXJyb3I6ICR7ZXJyfWApO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICAgICAgICBhZGRDYXJkUG9wdXAuaGlkZU1lc3NhZ2VMb2FkaW5nKCk7XHJcbiAgICAgICAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUFkZEJ1dHRvbigpIHtcclxuICAgIGFkZENhcmRQb3B1cC5vcGVuKCk7XHJcbiAgICBmb3JtRWxlbWVudEFkZFZhbGlkYXRvci5yZXNldFdob2xlRm9ybSgpO1xyXG59XHJcblxyXG5idXR0b25BZGQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZUFkZEJ1dHRvbik7XHJcblxyXG5jb25zdCBjYXJkTGlzdCA9IG5ldyBTZWN0aW9uKHtcclxuICAgIHJlbmRlcmVyOiAobmFtZSwgbGluaywgaWQsIG93bmVySWQsIGxpa2VzKSA9PiB7XHJcbiAgICAgICAgY29uc3QgY2FyZCA9IG5ldyBDYXJkKG5hbWUsIGxpbmssIGlkLCBvd25lcklkLCB1c2VySWQsIGxpa2VzLCBcIiNjYXJkXCIsIHtcclxuICAgICAgICAgICAgaGFuZGxlQ2FyZENsaWNrOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpbWFnZVBvcHVwLm9wZW4obmFtZSwgbGluayk7XHJcbiAgICAgICAgICAgIH0sIGhhbmRsZURlbGV0ZUNhcmQ6IChpZCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgZGVsZXRlUG9wdXAub3BlbigpO1xyXG4gICAgICAgICAgICAgICAgZGVsZXRlUG9wdXAuc2V0QWN0aW9uKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBkZWxldGVQb3B1cC5zaG93TWVzc2FnZUxvYWRpbmcoKTtcclxuICAgICAgICAgICAgICAgICAgICBhcGlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmRlbGV0ZUNhcmQoaWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcmQucmVtb3ZlQ2FyZEZyb21ET00oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZVBvcHVwLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgRXJyb3I6ICR7ZXJyfWApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVQb3B1cC5oaWRlTWVzc2FnZUxvYWRpbmcoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSwgaGFuZGxlTGlrZUJ1dHRvbjogKGlkKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpc0FscmVhZHlMaWtlZCA9IGNhcmQuaXNMaWtlZCgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzQWxyZWFkeUxpa2VkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXBpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC51bmxpa2VDYXJkKGlkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXJkLmhhbmRsZUxpa2VDYXJkKHJlcy5saWtlcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgRXJyb3I6ICR7ZXJyfWApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXBpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5saWtlQ2FyZChpZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FyZC5oYW5kbGVMaWtlQ2FyZChyZXMubGlrZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYEVycm9yOiAke2Vycn1gKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgfSlcclxuICAgICAgICByZXR1cm4gY2FyZC5nZW5lcmF0ZUNhcmQoKVxyXG4gICAgfVxyXG59LCBcIi5lbGVtZW50c19faXRlbXNcIik7XHJcblxyXG5cclxubGV0IHVzZXJJZDtcclxuUHJvbWlzZS5hbGwoW2FwaS5nZXRVc2VySW5mbygpLCBhcGkuZ2V0SW5pdGlhbENhcmRzKCldKVxyXG4gICAgLnRoZW4oKFt1c2VyRGF0YSwgY2FyZERhdGFdKSA9PiB7XHJcbiAgICAgICAgdXNlcklkID0gdXNlckRhdGEuX2lkO1xyXG4gICAgICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHtcclxuICAgICAgICAgICAgbmFtZTogdXNlckRhdGEubmFtZSwgYWJvdXQ6IHVzZXJEYXRhLmFib3V0LFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHVzZXJJbmZvLnNldEF2YXRhcih7YXZhdGFyOiB1c2VyRGF0YS5hdmF0YXJ9KTtcclxuICAgICAgICBjYXJkTGlzdC5yZW5kZXJJdGVtcyhjYXJkRGF0YS5yZXZlcnNlKCkpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coYEVycm9yOiAke2Vycn1gKTtcclxuICAgIH0pO1xyXG5cclxuZnVuY3Rpb24gaGFuZGxlUHJvZmlsZUltYWdlQ2xpY2soKSB7XHJcbiAgICBwcm9maWxlSW1hZ2VQb3B1cC5vcGVuKCk7XHJcbiAgICBmb3JtRWxlbWVudEltYWdlVmFsaWRhdG9yLnJlc2V0V2hvbGVGb3JtKCk7XHJcblxyXG59XHJcblxyXG5wcm9maWxlSW1hZ2VPdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVQcm9maWxlSW1hZ2VDbGljayk7XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVJbWFnZUZvcm1TdWJtaXQodXNlckRhdGEpIHtcclxuICAgIHByb2ZpbGVJbWFnZVBvcHVwLnNob3dNZXNzYWdlTG9hZGluZygpO1xyXG4gICAgYXBpXHJcbiAgICAgICAgLmVkaXRBdmF0YXIodXNlckRhdGEpXHJcbiAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgICAgICB1c2VySW5mby5zZXRBdmF0YXIocmVzKTtcclxuICAgICAgICAgICAgcHJvZmlsZUltYWdlUG9wdXAuY2xvc2UoKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBFcnJvcjogJHtlcnJ9YCk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgICAgICAgIHByb2ZpbGVJbWFnZVBvcHVwLmhpZGVNZXNzYWdlTG9hZGluZygpO1xyXG4gICAgICAgIH0pO1xyXG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcclxuICAgIGNvbnN0cnVjdG9yKHtiYXNlVXJsLCBoZWFkZXJzfSkge1xyXG4gICAgICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xyXG4gICAgICAgIHRoaXMuX2hlYWRlcnMgPSBoZWFkZXJzO1xyXG4gICAgfVxyXG5cclxuICAgIF9jdXN0b21GZXRjaCA9ICh1cmwsIGhlYWRlcnMpID0+IHtcclxuICAgICAgICByZXR1cm4gZmV0Y2godXJsLCBoZWFkZXJzKS50aGVuKChyZXMpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzLmpzb24oKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICApO1xyXG4gICAgfTtcclxuXHJcbiAgICBnZXRVc2VySW5mbygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0SW5pdGlhbENhcmRzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9jdXN0b21GZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVDYXJkKGRhdGEpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGRhdGEpLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGRlbGV0ZUNhcmQoY2FyZElkKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2N1c3RvbUZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfWAsIHtcclxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGVkaXRQcm9maWxlKHtuYW1lLCBhYm91dH0pIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgICAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICAgICAgICBuYW1lOiBuYW1lLFxyXG4gICAgICAgICAgICAgICAgYWJvdXQ6IGFib3V0LFxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBlZGl0QXZhdGFyKHthdmF0YXJ9KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2N1c3RvbUZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lL2F2YXRhcmAsIHtcclxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICAgICAgICAgIGF2YXRhcjogYXZhdGFyLFxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBsaWtlQ2FyZChjYXJkSWQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCwge1xyXG4gICAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICAgICAgICBtZXRob2Q6IFwiUFVUXCIsXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgdW5saWtlQ2FyZChjYXJkSWQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCwge1xyXG4gICAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICAgICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlckluZm8ge1xyXG4gICAgY29uc3RydWN0b3Ioe3VzZXJOYW1lU2VsZWN0b3IsIHVzZXJKb2JTZWxlY3RvciwgYXZhdGFyU2VsZWN0b3J9KSB7XHJcbiAgICAgICAgdGhpcy5fdXNlck5hbWVFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih1c2VyTmFtZVNlbGVjdG9yKTtcclxuICAgICAgICB0aGlzLl91c2VySm9iRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodXNlckpvYlNlbGVjdG9yKTtcclxuICAgICAgICB0aGlzLl9hdmF0YXJFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihhdmF0YXJTZWxlY3Rvcik7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VXNlckluZm8oKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgbmFtZTogdGhpcy5fdXNlck5hbWVFbGVtZW50LnRleHRDb250ZW50LFxyXG4gICAgICAgICAgICBhYm91dDogdGhpcy5fdXNlckpvYkVsZW1lbnQudGV4dENvbnRlbnQsXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRVc2VySW5mbyh7bmFtZSwgYWJvdXR9KSB7XHJcbiAgICAgICAgdGhpcy5fdXNlck5hbWVFbGVtZW50LnRleHRDb250ZW50ID0gbmFtZTtcclxuICAgICAgICB0aGlzLl91c2VySm9iRWxlbWVudC50ZXh0Q29udGVudCA9IGFib3V0O1xyXG4gICAgfVxyXG5cclxuICAgIHNldEF2YXRhcih7IGF2YXRhciB9KSB7XHJcbiAgICAgICAgdGhpcy5fYXZhdGFyRWxlbWVudC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBhdmF0YXJcclxuICAgICAgICAgICAgPyBgdXJsKCR7YXZhdGFyfSlgXHJcbiAgICAgICAgICAgIDogYHVybCgke3RoaXMuX2F2YXRhcn0pYDtcclxuICAgIH1cclxufSIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoSW1hZ2UgZXh0ZW5kcyBQb3B1cCB7XHJcbiAgICBjb25zdHJ1Y3Rvcihtb2RhbFdpbmRvdykge1xyXG4gICAgICAgIHN1cGVyKG1vZGFsV2luZG93KTtcclxuICAgICAgICB0aGlzLl9pbWFnZVpvb20gPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fdmlld2VyLWltYWdlXCIpO1xyXG4gICAgICAgIHRoaXMuX2ltYWdlWm9vbVRpdGxlID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX3ZpZXdlci10ZXh0XCIpO1xyXG4gICAgfVxyXG5cclxuICAgIG9wZW4obmFtZSwgbGluaykge1xyXG4gICAgICAgIHN1cGVyLm9wZW4oKTtcclxuICAgICAgICB0aGlzLl9pbWFnZVpvb20uc3JjID0gbGluaztcclxuICAgICAgICB0aGlzLl9pbWFnZVpvb20uYWx0ID0gYFBob3RvIG9mICR7bmFtZX1gO1xyXG4gICAgICAgIHRoaXMuX2ltYWdlWm9vbVRpdGxlLnRleHRDb250ZW50ID0gbmFtZTtcclxuICAgIH1cclxufSIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFBvcHVwV2l0aERlbGV0aW5nIGV4dGVuZHMgUG9wdXAge1xyXG4gICAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xyXG4gICAgICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgICAgIHRoaXMuX2lucHV0U3VibWl0ID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2J1dHRvbi1zYm10XCIpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEFjdGlvbihhY3Rpb24pIHtcclxuICAgICAgICB0aGlzLl9oYW5kbGVTdWJtaXQgPSBhY3Rpb247XHJcbiAgICB9XHJcblxyXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgICAgICB0aGlzLl9wb3B1cEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XHJcbiAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVTdWJtaXQoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBzaG93TWVzc2FnZUxvYWRpbmcoKSB7XHJcbiAgICAgICAgdGhpcy5faW5wdXRTdWJtaXQudmFsdWUgPSBcIkRlbGV0aW5nLi4uXCI7XHJcbiAgICB9XHJcblxyXG4gICAgaGlkZU1lc3NhZ2VMb2FkaW5nKCkge1xyXG4gICAgICAgIHRoaXMuX2lucHV0U3VibWl0LnZhbHVlID0gXCJZZXNcIjtcclxuICAgIH1cclxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlY3Rpb24ge1xyXG4gICAgY29uc3RydWN0b3Ioe3JlbmRlcmVyfSwgY29udGFpbmVyU2VsZWN0b3IpIHtcclxuICAgICAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xyXG4gICAgICAgIHRoaXMuX2NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyU2VsZWN0b3IpO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZEl0ZW0obmFtZSwgbGluaywgaWQsIG93bmVySWQsIGxpa2VzKSB7XHJcbiAgICAgICAgY29uc3QgY2FyZCA9IHRoaXMuX3JlbmRlcmVyKG5hbWUsIGxpbmssIGlkLCBvd25lcklkLCBsaWtlcyk7XHJcbiAgICAgICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoY2FyZCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVuZGVySXRlbXMoaXRlbXMpIHtcclxuICAgICAgICBpdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkSXRlbShpdGVtLm5hbWUsIGl0ZW0ubGluaywgaXRlbS5faWQsIGl0ZW0ub3duZXIuX2lkLCBpdGVtLmxpa2VzKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG4iXSwibmFtZXMiOlsiRm9ybVZhbGlkYXRvciIsImNvbnN0cnVjdG9yIiwic2V0dGluZ3NWYWxpZGF0b3IiLCJmb3JtRWxlbWVudCIsInRoaXMiLCJfaW5wdXRTZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJfc3VibWl0QnV0dG9uU2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsIl9pbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsIl9pbnB1dEVycm9yQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJfZXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJfZm9ybUVsZW1lbnQiLCJfc2hvd0lucHV0RXJyb3IiLCJpbnB1dEVsZW1lbnQiLCJlcnJvckVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiaWQiLCJjbGFzc0xpc3QiLCJhZGQiLCJ0ZXh0Q29udGVudCIsInZhbGlkYXRpb25NZXNzYWdlIiwiX2hpZGVJbnB1dEVycm9yIiwicmVtb3ZlIiwiX2NoZWNrSW5wdXRWYWxpZGl0eSIsInZhbGlkaXR5IiwidmFsaWQiLCJfaGFzSW52YWxpZElucHV0IiwiX2lucHV0TGlzdCIsInNvbWUiLCJfdG9nZ2xlQnV0dG9uU3RhdGUiLCJfYnV0dG9uRWxlbWVudCIsImRpc2FibGVkIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJhZGRFdmVudExpc3RlbmVyIiwiX2hpZGVWYWxpZGF0aW9uTWVzc2FnZSIsIkFycmF5IiwiZnJvbSIsInJlc2V0V2hvbGVGb3JtIiwicmVzZXQiLCJlbmFibGVWYWxpZGF0aW9uIiwiZXZ0IiwicHJldmVudERlZmF1bHQiLCJDYXJkIiwibmFtZSIsImxpbmsiLCJvd25lcklkIiwidXNlcklkIiwibGlrZXMiLCJjYXJkU2VsZWN0b3IiLCJoYW5kbGVDYXJkQ2xpY2siLCJoYW5kbGVMaWtlQnV0dG9uIiwiaGFuZGxlRGVsZXRlQ2FyZCIsIl9lbGVtZW50IiwiYWRkTGlrZSIsIl9saWtlcyIsIl9yZW5kZXJMaWtlcyIsIl9uYW1lIiwiX2xpbmsiLCJfY2FyZFNlbGVjdG9yIiwiX2hhbmRsZUNhcmRDbGljayIsIl9oYW5kbGVMaWtlQnV0dG9uIiwiX2hhbmRsZURlbGV0ZUNhcmQiLCJfaWQiLCJfdXNlcklkIiwiX293bmVySWQiLCJfZ2V0VGVtcGxhdGUiLCJkb2N1bWVudCIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJfZGVsZXRlQnV0dG9uIiwiX2xpa2VCdXR0b24iLCJfY2FyZEltYWdlIiwic3JjIiwiaXNMaWtlZCIsImxpa2VkQ2FyZCIsIl9saWtlc0NvdW50IiwibGVuZ3RoIiwiZ2VuZXJhdGVDYXJkIiwiX2NhcmROYW1lIiwiYWx0Iiwic3R5bGUiLCJkaXNwbGF5IiwiZm9ybVNlbGVjdG9yIiwiUG9wdXAiLCJtb2RhbFdpbmRvdyIsImtleSIsImNsb3NlIiwiX3BvcHVwRWxlbWVudCIsIm9wZW4iLCJfaGFuZGxlRXNjQ2xvc2UiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJ0YXJnZXQiLCJjb250YWlucyIsIlBvcHVwV2l0aEZvcm0iLCJoYW5kbGVGb3JtU3VibWl0IiwiYnV0dG9uVGV4dFZhbHVlIiwic3VwZXIiLCJfaGFuZGxlRm9ybVN1Ym1pdCIsIl9wb3B1cEZvcm0iLCJfYnV0dG9uU3VibWl0IiwiX2J1dHRvblRleHRWYWx1ZSIsIl9pbnB1dHMiLCJfZ2V0SW5wdXRWYWx1ZXMiLCJpbnB1dFZhbHVlcyIsImlucHV0IiwidmFsdWUiLCJzaG93TWVzc2FnZUxvYWRpbmciLCJoaWRlTWVzc2FnZUxvYWRpbmciLCJidXR0b25FZGl0IiwiYnV0dG9uQWRkIiwiZm9ybUVsZW1lbnRFZGl0IiwiZ2V0RWxlbWVudEJ5SWQiLCJmb3JtRWxlbWVudEFkZCIsImZvcm1FbGVtZW50SW1hZ2UiLCJuYW1lSW5wdXQiLCJqb2JJbnB1dCIsInByb2ZpbGVJbWFnZU92ZXJsYXkiLCJhcGkiLCJiYXNlVXJsIiwiaGVhZGVycyIsInVybCIsImZldGNoIiwidGhlbiIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiZ2V0VXNlckluZm8iLCJfY3VzdG9tRmV0Y2giLCJnZXRJbml0aWFsQ2FyZHMiLCJjcmVhdGVDYXJkIiwiZGF0YSIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiZGVsZXRlQ2FyZCIsImNhcmRJZCIsImVkaXRQcm9maWxlIiwiYWJvdXQiLCJlZGl0QXZhdGFyIiwiYXZhdGFyIiwibGlrZUNhcmQiLCJ1bmxpa2VDYXJkIiwiYXV0aG9yaXphdGlvbiIsInVzZXJJbmZvIiwidXNlck5hbWVTZWxlY3RvciIsInVzZXJKb2JTZWxlY3RvciIsImF2YXRhclNlbGVjdG9yIiwiX3VzZXJOYW1lRWxlbWVudCIsIl91c2VySm9iRWxlbWVudCIsIl9hdmF0YXJFbGVtZW50Iiwic2V0VXNlckluZm8iLCJzZXRBdmF0YXIiLCJiYWNrZ3JvdW5kSW1hZ2UiLCJfYXZhdGFyIiwiZWRpdFBvcHVwIiwiZGF0YVVzZXJzIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwibG9nIiwiZmluYWxseSIsImFkZENhcmRQb3B1cCIsImRhdGFJbWFnZXMiLCJ0aXRsZSIsImNhcmRMaXN0IiwiYWRkSXRlbSIsIm93bmVyIiwiaW1hZ2VQb3B1cCIsIl9pbWFnZVpvb20iLCJfaW1hZ2Vab29tVGl0bGUiLCJkZWxldGVQb3B1cCIsInBvcHVwU2VsZWN0b3IiLCJfaW5wdXRTdWJtaXQiLCJzZXRBY3Rpb24iLCJhY3Rpb24iLCJfaGFuZGxlU3VibWl0IiwicHJvZmlsZUltYWdlUG9wdXAiLCJ1c2VyRGF0YSIsImZvcm1FbGVtZW50RWRpdFZhbGlkYXRvciIsImZvcm1FbGVtZW50QWRkVmFsaWRhdG9yIiwiZm9ybUVsZW1lbnRJbWFnZVZhbGlkYXRvciIsImNvbnRhaW5lclNlbGVjdG9yIiwicmVuZGVyZXIiLCJfcmVuZGVyZXIiLCJfY29udGFpbmVyIiwiY2FyZCIsInByZXBlbmQiLCJyZW5kZXJJdGVtcyIsIml0ZW1zIiwiaXRlbSIsInJlbW92ZUNhcmRGcm9tRE9NIiwiaGFuZGxlTGlrZUNhcmQiLCJhbGwiLCJjYXJkRGF0YSIsInJldmVyc2UiXSwic291cmNlUm9vdCI6IiJ9